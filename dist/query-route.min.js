(e=>{const t="pageload",a="browser",o="back",s="",r={},l={},n={},i=a,h=(t,a=!0)=>{let s=p(t);t===o||s.fullroute===l.fullroute&&l.fullroute!==n.fullroute?null!==e.history.state&&(Object.assign(n,l),Object.assign(l,p(e.location.pathname+e.location.hash)),e.history.back()):e.history.pushState?(l.fullroute!==n.fullroute&&(Object.assign(l,n),k.setnext(t)),v(m(n.fullroute,n.href),a)):e.location.assign(r.url)},u=(e,t)=>{if(t[0]===s&&t.length>0&&t.shift(),e[0]!==t[0]&&":"!==t[0].slice(0,1))return!1;let a={};for(let o in e)if(e[o]!==t[o])if(":"===t[o].slice(0,1))a[t[o].slice(1)]=e[o];else if(e[o]!==t[o])return!1;return a},c=(e={},t=(()=>{}),a)=>{const o=a?p(a):n;let r={};if(o.route!==s)for(let[a,s]of Object.entries(e)){r={};let e=p(a);if(e.route===o.route){t=s;break}if(e.path[0]===o.path[0]&&e.path.length===o.path.length&&(r=u(o.path,e.path),!1!==r)){t=s;break}}return[t,r]},p=t=>{const a=d(t),[o,r]=a.split("#");return{fullroute:a,route:o,href:e.location.origin+k.root+a,hash:r?"#"+r:s,path:o.split("/")}},f=()=>[k.root,"/"],g=()=>new RegExp(`^(${f().join("|")})`),d=e=>e.replace(g(),s),m=(e,t)=>({title:e,url:t}),b=t=>a=>e.document.dispatchEvent(new CustomEvent(t,{detail:a})),v=(t,a)=>{n.path||k.setnext(e.location.pathname+e.location.hash),t??=m(n.fullroute,n.href),e.history[a?"pushState":"replaceState"](t,t.title,t.url),w.pageload({nextPage:t,prevPage:r}),Object.assign(r,t)},w={pageload:b(t),pagebeforeshow:b("pagebeforeshow"),pageshow:b("pageshow"),pagefail:b("pagefail")},k={state:r,root:"/",style:i,prev:l,next:n,navigate:h,matches:u,makepath:p,setnext:e=>Object.assign(n,p(e)),roots:f,rootregexp:g,remroot:d,isroot:e=>f().includes(e),hasroot:e=>e.match(g()),make:c,makestate:m,makeevent:b,events:w};if(e.q&&e.document){const r=async({page:e,data:t,selector:a=""})=>{try{w.pagebeforeshow({next:n,data:t,selector:a});let o=q(await e(t));q(a).html(o),w.pageshow({nextPage:o,data:t,selector:a})}catch(o){throw w.pagefail({page:e,data:t,selector:a}),o}},l=({routes:a={},defaultPage:o=(()=>s),errorPage:r=(e=>`Error: ${e}`),selector:l=".app"})=>{q(e.document).on(t,(async e=>{try{const[e,t]=c(a,o);await k.makepage({page:e,selector:l,data:t})}catch(e){throw k.makepage({page:r,selector:l,data:e}),"Page failed: "+e}}))};q((()=>{q(e.document).delegate("click","a",(function(e){if("hash"===k.style&&"#"===this.href[0]){e.preventDefault();const t=this.attributes.href.value.slice(1);t!==s&&h(t)}else if(k.style===a&&"link"===this.dataset.role){e.preventDefault();const t=this.attributes.href;t!==s&&h(t.value)}else k.style===a&&this.dataset.rel===o&&(e.preventDefault(),h(o))}))})),Object.assign(k,{makepage:r,init:l}),q.route=k}else e.route=k;e.addEventListener("load",(()=>{setTimeout((()=>e.addEventListener("popstate",(e=>v(e.state)))),0)})),e.addEventListener("DOMContentLoaded",(e=>v(null)))})(window);