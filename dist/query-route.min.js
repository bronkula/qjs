(e=>{const t="pageload",a="hash",o="browser",l="back",s="",r={},n={},i={},u=o,h=(t,a=!0)=>{let o=f(t);console.log(o.fullroute,n.fullroute,o.fullroute===n.fullroute),t===l||o.fullroute===n.fullroute&&n.fullroute!==i.fullroute?null!==e.history.state&&(Object.assign(i,n),Object.assign(n,f(e.location.pathname+e.location.hash)),e.history.back()):e.history.pushState?(Object.assign(n,i),k.setnext(t),x(w(i.fullroute,i.href),a)):e.location.assign(r.url)},c=(e,t)=>{if(t[0]===s&&t.length>0&&t.shift(),e[0]!==t[0]&&":"!==t[0].slice(0,1))return!1;let a={};for(let o in e)if(e[o]!==t[o])if(":"===t[o].slice(0,1))a[t[o].slice(1)]=e[o];else if(e[o]!==t[o])return!1;return a},p=(e={},t=(()=>{}),a)=>{const o=a?f(a):i;let l={};if(o.route!==s)for(let[a,s]of Object.entries(e)){l={};let e=f(a);if(e.route===o.route){t=s;break}if(e.path[0]===o.path[0]&&e.path.length===o.path.length&&(l=c(o.path,e.path),!1!==l)){t=s;break}}return[t,l]},f=t=>{const a=b(t),[o,l]=a.split("#");return{fullroute:a,route:o,href:e.location.origin+k.root+a,hash:l?"#"+l:s,path:o.split("/")}},g=()=>[k.root,"/"],d=()=>new RegExp(`^(${g().join("|")})`),b=e=>e.replace(d(),s),m=t=>t??k.style===o?b(e.location.pathname):k.style===a?e.location.hash.slice(1):s,w=(e,t)=>({title:e,url:t}),v=t=>a=>e.document.dispatchEvent(new CustomEvent(t,{detail:a})),y={pageload:v(t),pagebeforeshow:v("pagebeforeshow"),pageshow:v("pageshow"),pagefail:v("pagefail")},k={state:r,root:"/",style:u,prev:n,next:i,navigate:h,matches:c,makepath:f,setnext:e=>Object.assign(i,f(e)),roots:g,rootregexp:d,remroot:b,isroot:e=>g().includes(e),hasroot:e=>e.match(d()),getroot:m,make:p,events:y},x=(t,a)=>{i.path||k.setnext(m()),t??=w(i.fullroute,i.href),e.history[a?"pushState":"replaceState"](t,t.title,t.url),y.pageload({nextPage:t,prevPage:r}),Object.assign(r,t)};if(e.q&&e.document){const r=async({page:e,data:t,selector:a=""})=>{try{y.pagebeforeshow({next:i,data:t,selector:a});let o=q(await e(t));q(a).html(o),y.pageshow({nextPage:o,data:t,selector:a})}catch(o){throw y.pagefail({page:e,data:t,selector:a}),o}},n=({routes:a={},defaultPage:o=(()=>s),errorPage:l=(e=>`Error: ${e}`),selector:r=".app"})=>{q(e.document).on(t,(async e=>{try{const[e,t]=p(a,o);await k.makepage({page:e,selector:r,data:t})}catch(e){throw k.makepage({page:l,selector:r,data:e}),"Page failed: "+e}}))};q((()=>{q(e.document).delegate("click","a",(function(e){if(k.style===a&&"#"===this.href[0]){e.preventDefault();const t=this.attributes.href.value.slice(1);t!==s&&h(t)}else if(k.style===o&&"link"===this.dataset.role){e.preventDefault();const t=this.attributes.href;t!==s&&h(t.value)}else k.style===o&&this.dataset.rel===l&&(e.preventDefault(),h(l))}))})),Object.assign(k,{makepage:r,init:n}),q.route=k}else e.route=k;e.addEventListener("load",(()=>{setTimeout((()=>e.addEventListener("popstate",(e=>x(e.state)))),0)})),e.addEventListener("DOMContentLoaded",(e=>x(null)))})(window);