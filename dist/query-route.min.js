(t=>{const e="pageshow",a="hash",l="browser",s="back",o="/",i="",n={state:{},root:o,style:a,navigate:(e,r=!0)=>{if(e==s)null!=t.history.state&&t.history.back();else if(t.history.pushState){const s=[n.root,o].includes(e)?i:e;c({title:e,url:n.style===a?t.location.origin+t.location.pathname+"#"+e:n.style===l?t.location.origin+n.root+s:i},r)}else t.location.assign(n.state.url)},matches:(t,e)=>{if(t[0]!=e[0])return!1;let a={};for(let l in t)if(t[l]!=e[l])if(":"==e[l].slice(0,1))a[e[l].slice(1)]=t[l];else if(t[l]!=e[l])return!1;return a},getroot:e=>e??n.style===l?t.location.pathname.slice(n.root.length):n.style===a?t.location.hash.slice(1):i,make:(t={},e=(()=>{}),a)=>{let l=n.getroot(a),s=l.split(o),r={};if(l!=i)for(let[a,i]of Object.entries(t)){if(r={},a==l){e=i;break}let t=a.split(o);if(t[0]==s[0]&&t.length==s.length&&(r=n.matches(s,t),!1!==r)){e=i;break}}return t=>e(r,t)}},r=a=>t.document.dispatchEvent(new CustomEvent(e,{detail:{nextPage:{...a},prevPage:{...n.state}}})),c=(e,s)=>{null==e&&(e={title:n.style===a?t.location.hash.slice(1):n.style===l?t.location.pathname.slice(n.root.length):i,url:t.location.href}),t.history[s?"pushState":"replaceState"](e,e.title,e.url),r(e),n.state={...e}};t.q&&t.document?(n.makepage=async({page:t,data:e,selector:a=""})=>{try{let l=await t(e);q(a).html(l)}catch(t){throw t}},n.init=({routes:a={},defaultPage:l=(()=>i),errorPage:s=(t=>`Error: ${t}`),selector:o=".app"})=>{q(t.document).on(e,(async t=>{try{const t=n.make(a,l);await n.makepage({page:t,selector:o})}catch(t){throw n.makepage({page:s,selector:o,data:t}),"Page failed: "+t}}))},q((()=>{q(t.document).delegate("click","a",(function(t){if(n.style===a&&"#"===this.href[0]){t.preventDefault();const e=this.attributes.href.value.slice(1);e!==i&&n.navigate(e)}else if(n.style===l&&"link"===this.dataset.role){t.preventDefault();const e=this.attributes.href;e!==i&&n.navigate(e.value)}else n.style===l&&this.dataset.rel===s&&(t.preventDefault(),n.navigate(s))}))})),q.route=n):t.route=n,t.addEventListener("load",(()=>{setTimeout((()=>t.addEventListener("popstate",(t=>c(t.state)))),0)})),t.addEventListener("DOMContentLoaded",(t=>{c(null)}))})(window);