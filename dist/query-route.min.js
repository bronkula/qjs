(e=>{const t="pageload",a="browser",o="back",r="",s={},l={},i={},n=a,u=(t,a=!0)=>{let r=p(t);if(t===o||r.fullroute===l.fullroute&&l.fullroute!==i.fullroute)null!==e.history.state&&e.history.back();else{if(!e.history.pushState)return void e.location.assign(s.url);v(m(r.fullroute,r.href),a)}},h=(e,t)=>{if(t[0]===r&&t.length>0&&t.shift(),e[0]!==t[0]&&":"!==t[0].slice(0,1))return!1;let a={};for(let o in e)if(e[o]!==t[o])if(":"===t[o].slice(0,1))a[t[o].slice(1)]=e[o];else if(e[o]!==t[o])return!1;return a},c=(e={},t=(()=>{}),a)=>{const o=a?p(a):i;let s={};if(o.route!==r)for(let[a,r]of Object.entries(e)){s={};let e=p(a);if(e.route===o.route){t=r;break}if(e.path[0]===o.path[0]&&e.path.length===o.path.length&&(s=h(o.path,e.path),!1!==s)){t=r;break}}return[t,s]},p=t=>{const a=d(t),[o,s]=a.split("#");return{fullroute:a,route:o,href:e.location.origin+k.root+a,hash:s?"#"+s:r,path:o.split("/")}},f=()=>[k.root,"/"],g=()=>new RegExp(`^(${f().join("|")})`),d=e=>e.replace(g(),r),w=t=>a=>e.document.dispatchEvent(new CustomEvent(t,{detail:a})),m=(e,t,a)=>(m.id=a??void 0!==m.id?m.id+1:0,{id:m.id,title:e,url:t}),v=(t,a)=>{const o=p(t?.title??e.location.pathname+e.location.hash);newstate=t??m(o.fullroute,o.href),t&&Object.assign(l,i),Object.assign(i,o),e.history[a&&l.fullroute!==i.fullroute?"pushState":"replaceState"](newstate,newstate.title,newstate.url),b.pageload({nextPage:newstate,prevPage:s}),Object.assign(s,newstate)},b={pageload:w(t),pagebeforeshow:w("pagebeforeshow"),pageshow:w("pageshow"),pagefail:w("pagefail")},k={state:s,root:"/",style:n,prev:l,next:i,navigate:u,matches:h,makepath:p,roots:f,rootregexp:g,remroot:d,isroot:e=>f().includes(e),hasroot:e=>e.match(g()),make:c,makestate:m,makeevent:w,events:b};if(e.q&&e.document){const s=async({page:e,data:t,selector:a=""})=>{try{b.pagebeforeshow({next:i,data:t,selector:a});let o=q(await e(t));q(a).html(o),b.pageshow({nextPage:o,data:t,selector:a})}catch(o){throw b.pagefail({page:e,data:t,selector:a}),o}},l=({routes:a={},defaultPage:o=(()=>r),errorPage:s=(e=>`Error: ${e}`),selector:l=".app"})=>{q(e.document).on(t,(async({detail:{nextPage:e,prevPage:t}})=>{try{const[e,t]=c(a,o);await k.makepage({page:e,selector:l,data:t})}catch(e){throw k.makepage({page:s,selector:l,data:e}),"Page failed: "+e}}))};q((()=>{q(e.document).on("click","a",(function(e){if("hash"===k.style&&"#"===this.href[0]){e.preventDefault();const t=this.attributes.href.value.slice(1);t!==r&&u(t)}else if(k.style===a&&"link"===this.dataset.role){e.preventDefault();const t=this.attributes.href;t!==r&&u(t.value)}else k.style===a&&this.dataset.rel===o&&(e.preventDefault(),u(o))}))})),Object.assign(k,{makepage:s,init:l}),q.route=k}else e.route=k;e.addEventListener("load",(()=>{setTimeout((()=>e.addEventListener("popstate",(e=>v(e.state)))),0)})),e.addEventListener("DOMContentLoaded",(e=>v(null)))})(window);