(t=>{const e="pageshow",a="hash",o="browser",r="back",l="/",s="",i={},n=(e,a=!0)=>{e===r?null!=t.history.state&&t.history.back():t.history.pushState?w({title:e,url:h(e)},a):t.location.assign(i.url)},c=(t,e)=>{if(e[0]===s&&e.length>0&&e.shift(),t[0]!=e[0])return!1;let a={};for(let o in t)if(t[o]!=e[o])if(":"==e[o].slice(0,1))a[e[o].slice(1)]=t[o];else if(t[o]!=e[o])return!1;return a},h=e=>{if(v.style===a)return t.location.origin+t.location.pathname+(d(e)?s:"#"+e);if(v.style===o){const a=g(e)?v.root+p(e):t.location.pathname+l+e;return t.location.origin+a}return s},u=()=>[v.root,l],f=()=>new RegExp(`^(${u().join("|")})`),p=t=>t.replace(f(),s),d=t=>u().includes(t),g=t=>t.match(f()),m=e=>e??v.style===o?t.location.pathname.slice(v.root.length):v.style===a?t.location.hash.slice(1):s,y=(t={},e=(()=>{}),a)=>{let o=m(a),r=o.split(l),i={};if(o!==s)for(let[a,s]of Object.entries(t)){if(i={},a===o){e=s;break}let t=a.split(l);if(t[0]===r[0]&&t.length===r.length&&(i=c(r,t),!1!==i)){e=s;break}}return t=>e(i,t)},v={state:i,root:l,style:a,navigate:n,matches:c,makenext:h,roots:u,rootregexp:f,rootremove:p,isroot:d,hasroot:g,getroot:m,make:y},b=a=>t.document.dispatchEvent(new CustomEvent(e,{detail:{nextPage:{...a},prevPage:{...i}}})),w=(e,a)=>{null===e&&(e={title:m(),url:t.location.href}),t.history[a?"pushState":"replaceState"](e,e.title,e.url),b(e),Object.entries(e).forEach((([t,e])=>i[t]=e))};if(t.q&&t.document){const l=async({page:t,data:e,selector:a=""})=>{try{let o=await t(e);q(a).html(o)}catch(t){throw t}},i=({routes:a={},defaultPage:o=(()=>s),errorPage:r=(t=>`Error: ${t}`),selector:i=".app"})=>{q(t.document).on(e,(async()=>{try{const t=y(a,o);await l({page:t,selector:i})}catch(t){throw l({page:r,selector:i,data:t}),"Page failed: "+t}}))};q((()=>{q(t.document).delegate("click","a",(function(t){if(v.style===a&&"#"===this.href[0]){t.preventDefault();const e=this.attributes.href.value.slice(1);e!==s&&n(e)}else if(v.style===o&&"link"===this.dataset.role){t.preventDefault();const e=this.attributes.href;e!==s&&n(e.value)}else v.style===o&&this.dataset.rel===r&&(t.preventDefault(),n(r))}))})),Object.entries({makepage:l,init:i}).forEach((([t,e])=>v[t]=e)),q.route=v}else t.route=v;t.addEventListener("load",(()=>{setTimeout((()=>t.addEventListener("popstate",(t=>w(t.state)))),0)})),t.addEventListener("DOMContentLoaded",(t=>{w(null)}))})(window);