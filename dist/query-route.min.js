(e=>{const t="pageload",a="hash",o="browser",s="back",n="/",r="",l={},i=(t,a=!0)=>{t===s?null!=e.history.state&&e.history.back():e.history.pushState?k(w(t,p(t)),a):e.location.assign(l.url)},c=(e,t)=>{if(t[0]===r&&t.length>0&&t.shift(),e[0]!==t[0]&&":"!==t[0].slice(0,1))return!1;let a={};for(let o in e)if(e[o]!==t[o])if(":"===t[o].slice(0,1))a[t[o].slice(1)]=e[o];else if(e[o]!==t[o])return!1;return a},h=(e={},t=(()=>{}),a)=>{let o=v(a),s=o.split(n),l={};if(o!==r)for(let[a,r]of Object.entries(e)){if(l={},a===o){t=r;break}let e=a.split(n);if(e[0]===s[0]&&e.length===s.length&&(l=c(s,e),!1!==l)){t=r;break}}return[t,l]},p=t=>{if(b.style===a)return e.location.origin+e.location.pathname+(f(t)?r:"#"+t);if(b.style===o){const a=m(t)?b.root+u(t):e.location.pathname+n+t;return e.location.origin+a}return r},d=()=>[b.root,n],g=()=>new RegExp(`^(${d().join("|")})`),u=e=>e.replace(g(),r),f=e=>d().includes(e),m=e=>e.match(g()),v=t=>t??b.style===o?e.location.pathname.slice(b.root.length):b.style===a?e.location.hash.slice(1):r,w=(e,t)=>({title:e,url:t}),y={pageload:a=>e.document.dispatchEvent(new CustomEvent(t,{detail:a})),pagebeforeshow:t=>e.document.dispatchEvent(new CustomEvent("pagebeforeshow",{detail:t})),pageshow:t=>e.document.dispatchEvent(new CustomEvent("pageshow",{detail:t})),pagefail:t=>e.document.dispatchEvent(new CustomEvent("pagefail",{detail:t}))},b={state:l,root:n,style:a,navigate:i,matches:c,makenext:p,roots:d,rootregexp:g,rootremove:u,isroot:f,hasroot:m,getroot:v,make:h,events:y},k=(t,a)=>{t??=w(v(),e.location.href),e.history[a?"pushState":"replaceState"](t,t.title,t.url),y.pageload({nextPage:{...t},prevPage:{...l}}),Object.assign(l,t)};if(e.q&&e.document){const n=async({page:e,data:t,selector:a=""})=>{try{y.pagebeforeshow({root:v(),data:t,selector:a});let o=q(await e(t));q(a).html(o),y.pageshow({nextPage:o,data:t,selector:a})}catch(o){throw y.pagefail({page:e,data:t,selector:a}),o}},l=({routes:a={},defaultPage:o=(()=>r),errorPage:s=(e=>`Error: ${e}`),selector:n=".app"})=>{q(e.document).on(t,(async e=>{try{const[e,t]=h(a,o);await b.makepage({page:e,selector:n,data:t})}catch(e){throw b.makepage({page:s,selector:n,data:e}),"Page failed: "+e}}))};q((()=>{q(e.document).delegate("click","a",(function(e){if(b.style===a&&"#"===this.href[0]){e.preventDefault();const t=this.attributes.href.value.slice(1);t!==r&&i(t)}else if(b.style===o&&"link"===this.dataset.role){e.preventDefault();const t=this.attributes.href;t!==r&&i(t.value)}else b.style===o&&this.dataset.rel===s&&(e.preventDefault(),i(s))}))})),Object.assign(b,{makepage:n,init:l}),q.route=b}else e.route=b;e.addEventListener("load",(()=>{setTimeout((()=>e.addEventListener("popstate",(e=>k(e.state)))),0)})),e.addEventListener("DOMContentLoaded",(e=>k(null)))})(window);